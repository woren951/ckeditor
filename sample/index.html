<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>CKEditor 5 ‚Äì classic editor build ‚Äì development sample</title>
    <style>
        body {
            max-width: 800px;
            margin: 20px auto;
        }

    </style>

    <style>
        .update {
            border: 1px solid var(--ck-color-base-border);
            border-radius: var(--ck-border-radius);
            box-shadow: 2px 2px 0px hsla( 0, 0%, 0%, 0.1 );
            margin: 1.5em 0;
            padding: 1em;
        }

        .update h3 {
            font-size: 18px;
            font-weight: bold;
            margin: 0 0 .5em;
            padding: 0;
        }

        .update .ck.ck-editor__editable_inline {
            border: 1px solid hsla( 0, 0%, 0%, 0.15 );
            transition: background .5s ease-out;
            min-height: 6em;
            margin-bottom: 1em;
        }

        .update__controls {
            display: flex;
            flex-direction: row;
            align-items: center;
        }

        .update__chart {
            margin-right: 1em;
        }

        .update__chart__circle {
            transform: rotate(-90deg);
            transform-origin: center;
        }

        .update__chart__characters {
            font-size: 13px;
            font-weight: bold;
        }

        .update__words {
            flex-grow: 1;
            opacity: .5;
        }

        .update__limit-close .update__chart__circle {
            stroke: hsl( 30, 100%, 52% );
        }

        .update__limit-exceeded .ck.ck-editor__editable_inline {
            background: hsl( 0, 100%, 97% );
        }

        .update__limit-exceeded .update__chart__circle {
            stroke: hsl( 0, 100%, 52% );
        }

        .update__limit-exceeded .update__chart__characters {
            fill: hsl( 0, 100%, 52% );
        }
    </style>
</head>

<body>

    <h1>CKEditor 5</h1>

    <div class="update">
        <div id="classic-editor">
            <h2>Classic</h2>

            <p>This is an instance of the lore <a
                    href="https://docs.ckeditor.com/ckeditor5/latest/builds/guides/overview.html#classic-editor">classic
                    editor build</a>.</p>

            <h3>Resize me!</h3>

            <figure class="image">
                <img src="https://ckeditor.com/docs/ckeditor5/latest/assets/img/fields.jpg" alt="Autumn fields">
                <figcaption>Autumn fields by Aleksander Nowodzi≈Ñski</figcaption>
            </figure>

            <p>You can use this sample to validate whether your <a
                    href="https://docs.ckeditor.com/ckeditor5/latest/builds/guides/development/custom-builds.html">custom
                    build</a> works fine.</p>
        </div>

        <div class="update__controls">
            <span class="update__words"></span>
            <svg class="update__chart" viewbox="0 0 40 40" width="40" height="40" xmlns="http://www.w3.org/2000/svg">
                <circle stroke="hsl(0, 0%, 93%)" stroke-width="3" fill="none" cx="20" cy="20" r="17" />
                <circle class="update__chart__circle" stroke="hsl(202, 92%, 59%)" stroke-width="3" stroke-dasharray="134,534" stroke-linecap="round" fill="none" cx="20" cy="20" r="17" />
                <text class="update__chart__characters" x="50%" y="50%" dominant-baseline="central" text-anchor="middle"></text>
            </svg>
        </div>
    </div>

    <div class="update">
        <div id="inline-editor">
            <h2>Inline</h2>

            <p>This is an instance of the <a
                    href="https://docs.ckeditor.com/ckeditor5/latest/builds/guides/overview.html#classic-editor">classic
                    editor build</a>.</p>

            <h3>Resize me!</h3>

            <figure class="image">
                <img src="https://ckeditor.com/docs/ckeditor5/latest/assets/img/fields.jpg" alt="Autumn fields">
                <figcaption>Autumn fields by Aleksander Nowodzi≈Ñski</figcaption>
            </figure>

            <p>You can use this sample to validate whether your <a
                    href="https://docs.ckeditor.com/ckeditor5/latest/builds/guides/development/custom-builds.html">custom
                    build</a> works fine.</p>
        </div>

        <div class="update__controls">
            <span class="update__words"></span>
            <svg class="update__chart" viewbox="0 0 40 40" width="40" height="40" xmlns="http://www.w3.org/2000/svg">
                <circle stroke="hsl(0, 0%, 93%)" stroke-width="3" fill="none" cx="20" cy="20" r="17" />
                <circle class="update__chart__circle" stroke="hsl(202, 92%, 59%)" stroke-width="3" stroke-dasharray="134,534" stroke-linecap="round" fill="none" cx="20" cy="20" r="17" />
                <text class="update__chart__characters" x="50%" y="50%" dominant-baseline="central" text-anchor="middle"></text>
            </svg>
        </div>
    </div>

    <div class="update">
        <div id="balloon-editor">
            <h2>Balloon</h2>

            <p>This is an instance of the <a
                    href="https://docs.ckeditor.com/ckeditor5/latest/builds/guides/overview.html#classic-editor">classic
                    editor build</a>.</p>

            <h3>Resize me!</h3>

            <figure class="image">
                <img src="https://ckeditor.com/docs/ckeditor5/latest/assets/img/fields.jpg" alt="Autumn fields">
                <figcaption>Autumn fields by Aleksander Nowodzi≈Ñski</figcaption>
            </figure>

            <p>You can use this sample to validate whether your <a
                    href="https://docs.ckeditor.com/ckeditor5/latest/builds/guides/development/custom-builds.html">custom
                    build</a> works fine.</p>
        </div>

        <div class="update__controls">
            <span class="update__words"></span>
            <svg class="update__chart" viewbox="0 0 40 40" width="40" height="40" xmlns="http://www.w3.org/2000/svg">
                <circle stroke="hsl(0, 0%, 93%)" stroke-width="3" fill="none" cx="20" cy="20" r="17" />
                <circle class="update__chart__circle" stroke="hsl(202, 92%, 59%)" stroke-width="3" stroke-dasharray="134,534" stroke-linecap="round" fill="none" cx="20" cy="20" r="17" />
                <text class="update__chart__characters" x="50%" y="50%" dominant-baseline="central" text-anchor="middle"></text>
            </svg>
        </div>
    </div>

    <script src="../build/ckeditor.js"></script>
    <!-- <script src="../node_modules/@ckeditor/ckeditor5-inspector/build/inspector.js"></script> -->

    <script>
        const link = {
                decorators: {
                    addTargetToLinks: {
                        mode: 'manual',
                        label: '–í—ñ–¥–∫—Ä–∏—Ç–∏ –≤ –Ω–æ–≤–æ–º—É –≤—ñ–∫–Ω—ñ',
                        attributes: {
                            target: '_blank',
                            rel: 'noopener noreferrer'
                        }
                    },
                    detectDownloadable: {
                        mode: 'manual',
                        label: '–ó–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞–Ω–Ω—è',
                        attributes: {
                            download: 'download'
                        }
                    }
                }
        };

        const typing = {
            transformations: {
                include: [
                    // Use only the 'typography', 'symbols' and 'mathematical' groups.
                    'typography',
                    'symbols',
                    'mathematical'
                ],
                remove: [
                    // Remove the 'quotes' transformation loaded by the 'typography' group.
                    'quotes'
                ],
                extra: [
                    { from: ':)', to: 'üôÇ' },
                    { from: ':+1:', to: 'üëç' },
                    { from: ':tada:', to: 'üéâ' },
                    { from: ':flag_ua:', to: 'üá∫üá¶' },
                    { from: '<<', to: '¬´' },
                    { from: '>>', to: '¬ª' },
                    {
                        from: /(^|\s)(")([^"]*)(")$/,
                        to: [ null, '¬´', null, '¬ª' ]
                    },
                    {
                        from: /(\. )([a-z]|[\w–∞-—è])$/,
                        to: matches => [ null, matches[ 1 ].toUpperCase() ]
                    }
                ],
            }
        };

        const mention = {
            feeds: [
                {
                    marker: '@',
                    feed: ['@Barney', '@Lily', '@Marshall', '@Robin', '@Ted'],
                    minimumCharacters: 1
                },
                {
                    marker: ':',
                    feed: [':order', ':delivery'],
                    minimumCharacters: 2
                }
            ]
        };

        const maxCharacters = 1200;

        const classicEditorElement = document.querySelector('#classic-editor');
        const classicEditorWordCount = {
            container: classicEditorElement.parentElement,
            progressCircle: classicEditorElement.parentElement.querySelector( '.update__chart__circle' ),
            charactersBox: classicEditorElement.parentElement.querySelector( '.update__chart__characters' ),
            wordsBox: classicEditorElement.parentElement.querySelector( '.update__words' ),
            circleCircumference: Math.floor( 2 * Math.PI * classicEditorElement.parentElement.querySelector( '.update__chart__circle' ).getAttribute( 'r' ) )
        };

        Ckeditor.ClassicEditor.create(classicEditorElement, {
            link: link,
            mention: mention,
            typing: typing,
            wordCount: {
                onUpdate: stats => {
                    const charactersProgress = stats.characters / maxCharacters * classicEditorWordCount.circleCircumference;
                    const isLimitExceeded = stats.characters > maxCharacters;
                    const isCloseToLimit = !isLimitExceeded && stats.characters > maxCharacters * .8;
                    const circleDashArray = Math.min( charactersProgress, classicEditorWordCount.circleCircumference );

                    // Set the stroke of the circle to show how many characters were typed.
                    classicEditorWordCount.progressCircle.setAttribute( 'stroke-dasharray', `${ circleDashArray },${ classicEditorWordCount.circleCircumference }` );

                    // Display the number of characters in the progress chart. When the limit is exceeded,
                    // display how many characters should be removed.
                    if ( isLimitExceeded ) {
                        classicEditorWordCount.charactersBox.textContent = `-${ stats.characters - maxCharacters }`;
                    } else {
                        classicEditorWordCount.charactersBox.textContent = stats.characters;
                    }

                    classicEditorWordCount.wordsBox.textContent = `Words in the post: ${ stats.words }`;

                    // If the content length is close to the character limit, add a CSS class to warn the user.
                    classicEditorWordCount.container.classList.toggle( 'demo-update__limit-close', isCloseToLimit );

                    // If the character limit is exceeded, add a CSS class that makes the content's background red.
                    classicEditorWordCount.container.classList.toggle( 'demo-update__limit-exceeded', isLimitExceeded );
                }
            }
        })
        .then(editor => {
            // CKEditorInspector.attach( editor );

            // editor.data.stringify = modelElementOrFragment => {
            //     const data = {
            //         root: modelElementOrFragment.toJSON(),
            //         children: Array.from( modelElementOrFragment.getChildren() ).map( child => child.toJSON() )
            //     };

            //     return JSON.stringify( data );
            // };

            window.classicEditor = editor;
        })
        .catch(err => {
            console.error(err.stack);
        });

        const inlineEditorElement = document.querySelector('#inline-editor');
        const inlineEditorWordCount = {
            container: inlineEditorElement.parentElement,
            progressCircle: inlineEditorElement.parentElement.querySelector( '.update__chart__circle' ),
            charactersBox: inlineEditorElement.parentElement.querySelector( '.update__chart__characters' ),
            wordsBox: inlineEditorElement.parentElement.querySelector( '.update__words' ),
            circleCircumference: Math.floor( 2 * Math.PI * inlineEditorElement.parentElement.querySelector( '.update__chart__circle' ).getAttribute( 'r' ) )
        };

        Ckeditor.InlineEditor.create(inlineEditorElement, {
            link: link,
            mention: mention,
            typing: typing,
            wordCount: {
                onUpdate: stats => {
                    const charactersProgress = stats.characters / maxCharacters * inlineEditorWordCount.circleCircumference;
                    const isLimitExceeded = stats.characters > maxCharacters;
                    const isCloseToLimit = !isLimitExceeded && stats.characters > maxCharacters * .8;
                    const circleDashArray = Math.min( charactersProgress, inlineEditorWordCount.circleCircumference );

                    // Set the stroke of the circle to show how many characters were typed.
                    inlineEditorWordCount.progressCircle.setAttribute( 'stroke-dasharray', `${ circleDashArray },${ inlineEditorWordCount.circleCircumference }` );

                    // Display the number of characters in the progress chart. When the limit is exceeded,
                    // display how many characters should be removed.
                    if ( isLimitExceeded ) {
                        inlineEditorWordCount.charactersBox.textContent = `-${ stats.characters - maxCharacters }`;
                    } else {
                        inlineEditorWordCount.charactersBox.textContent = stats.characters;
                    }

                    inlineEditorWordCount.wordsBox.textContent = `Words in the post: ${ stats.words }`;

                    // If the content length is close to the character limit, add a CSS class to warn the user.
                    inlineEditorWordCount.container.classList.toggle( 'demo-update__limit-close', isCloseToLimit );

                    // If the character limit is exceeded, add a CSS class that makes the content's background red.
                    inlineEditorWordCount.container.classList.toggle( 'demo-update__limit-exceeded', isLimitExceeded );
                }
            }
        })
        .then(editor => {
            // CKEditorInspector.attach( editor );
            window.inlineEditor = editor;
        })
        .catch(err => {
            console.error(err.stack);
        });

        const balloonEditorElement = document.querySelector('#balloon-editor');
        const balloonEditorWordCount = {
            container: balloonEditorElement.parentElement,
            progressCircle: balloonEditorElement.parentElement.querySelector( '.update__chart__circle' ),
            charactersBox: balloonEditorElement.parentElement.querySelector( '.update__chart__characters' ),
            wordsBox: balloonEditorElement.parentElement.querySelector( '.update__words' ),
            circleCircumference: Math.floor( 2 * Math.PI * balloonEditorElement.parentElement.querySelector( '.update__chart__circle' ).getAttribute( 'r' ) )
        };

        Ckeditor.BalloonEditor.create(balloonEditorElement, {
            link: link,
            mention: mention,
            typing: typing,
            wordCount: {
                onUpdate: stats => {
                    const charactersProgress = stats.characters / maxCharacters * balloonEditorWordCount.circleCircumference;
                    const isLimitExceeded = stats.characters > maxCharacters;
                    const isCloseToLimit = !isLimitExceeded && stats.characters > maxCharacters * .8;
                    const circleDashArray = Math.min( charactersProgress, balloonEditorWordCount.circleCircumference );

                    // Set the stroke of the circle to show how many characters were typed.
                    balloonEditorWordCount.progressCircle.setAttribute( 'stroke-dasharray', `${ circleDashArray },${ balloonEditorWordCount.circleCircumference }` );

                    // Display the number of characters in the progress chart. When the limit is exceeded,
                    // display how many characters should be removed.
                    if ( isLimitExceeded ) {
                        balloonEditorWordCount.charactersBox.textContent = `-${ stats.characters - maxCharacters }`;
                    } else {
                        balloonEditorWordCount.charactersBox.textContent = stats.characters;
                    }

                    balloonEditorWordCount.wordsBox.textContent = `Words in the post: ${ stats.words }`;

                    // If the content length is close to the character limit, add a CSS class to warn the user.
                    balloonEditorWordCount.container.classList.toggle( 'demo-update__limit-close', isCloseToLimit );

                    // If the character limit is exceeded, add a CSS class that makes the content's background red.
                    balloonEditorWordCount.container.classList.toggle( 'demo-update__limit-exceeded', isLimitExceeded );
                }
            }
        })
        .then(editor => {
            // CKEditorInspector.attach( editor );
            window.balloonEditor = editor;
        })
        .catch(err => {
            console.error(err.stack);
        });
    </script>

</body>

</html>
